<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Part Organizer - Locations</title>
    <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">Part Organizer</span>
            <div class="d-flex gap-2">
                <a href="index.html" class="btn btn-secondary">Back to Parts</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Add Location Form -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Add New Location</h5>
            </div>
            <div class="card-body">
                <form id="locationForm">
                    <div class="mb-3">
                        <label for="locationName" class="form-label">Location Name *</label>
                        <input type="text" class="form-control" id="locationName" name="locationName" required>
                    </div>
                    <div class="mb-3">
                        <label for="container" class="form-label">Container</label>
                        <input type="text" class="form-control" id="container" name="container">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Location</button>
                </form>
            </div>
        </div>

        <!-- Locations List -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Existing Locations</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Location Name</th>
                            <th>Container</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="locationsList">
                        <!-- Locations will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="/assets/bootstrap/bootstrap.bundle.min.js"></script>
    <script>
        // API endpoints
        const API = {
            locations: '/api/inventory/locations',
            deleteLocation: (name) => `/api/inventory/locations/${encodeURIComponent(name)}`
        };

        // DOM Elements
        const locationForm = document.getElementById('locationForm');
        const locationsList = document.getElementById('locationsList');

        // Event Listeners
        locationForm.addEventListener('submit', handleAddLocation);

        // Initialize
        loadLocations();

        async function loadLocations() {
            try {
                const response = await fetch(API.locations);
                const locations = await response.json();
                locationsList.innerHTML = locations.map(location => `
                    <tr>
                        <td>${location.locationName}</td>
                        <td>${location.container || '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" 
                                onclick="deleteLocation('${location.locationName}')"
                                ${location.hasOwnProperty('partsCount') && location.partsCount > 0 ? 'disabled' : ''}>
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('') || '<tr><td colspan="3" class="text-center">No locations found</td></tr>';
            } catch (error) {
                console.error('Error loading locations:', error);
                locationsList.innerHTML = '<tr><td colspan="3" class="text-center text-danger">Failed to load locations</td></tr>';
            }
        }

        async function handleAddLocation(e) {
            e.preventDefault();
            const formData = {
                locationName: document.getElementById('locationName').value,
                container: document.getElementById('container').value
            };

            try {
                const response = await fetch(API.locations, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to create location');
                }

                // Reset form and reload locations
                locationForm.reset();
                await loadLocations();
            } catch (error) {
                console.error('Error adding location:', error);
                alert(error.message || 'Failed to add location');
            }
        }

        async function deleteLocation(locationName) {
            if (!confirm(`Are you sure you want to delete location "${locationName}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await fetch(API.deleteLocation(locationName), {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to delete location');
                }

                await loadLocations();
            } catch (error) {
                console.error('Error deleting location:', error);
                alert(error.message || 'Failed to delete location');
            }
        }
    </script>
</body>
</html>
